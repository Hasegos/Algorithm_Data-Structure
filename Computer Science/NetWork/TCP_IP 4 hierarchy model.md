# TCP/IP 4계층 모델

**인터넷 프로토콜 스위트(internet protocol suite)** 는 인터넷에서 컴퓨터들이 **서로 정보를 주고받는 데 쓰이는 프로토콜의 집합**이다.  
이를 설명할때, TCP/IP 4계층 혹은 OSI 7계층 모델로 설명한다.  
TCP/IP 4계층은 네트워킹 범위에 따라 네 개의 **추상화 계층**으로 구성된다.  

## 계층 구조

**TCP/IP 4계층 구조**

![1 (1)](https://github.com/Hasegos/Study_CS/assets/93961708/88917d5e-96d6-4f5d-994a-ce31be31643c)

**TCP/IP vs OSI**
애플리케이션 계층 -> 애플리케이션 계층, 프레젠테이션 계층, 세션 계층  
인터넷 계층 -> 네트워크 계층  
링크 계층 -> 데이터 링크 계층 , 물리 계층  
  
추가로 계층들은 특정 계층이 변경되었을때 **다른 계층이 영향 받지 않도록** 설계되어있다.  
ex) TCP 를 UDP로 변경했다고 인터넷 브라우저를 다시 설치해야하는건 아님  

**각 계층을 대표하는 스택**

![2 (1)](https://github.com/Hasegos/Study_CS/assets/93961708/2e414a85-42e4-47d2-a3cc-5889302b05a4)

## 애플리케이션 계층

**애플리케이션 계층**은 **HTTP, FTP, SSH, SMTP, DNS**등 웹 서비스, 이메일등 서비스를 실질적으로 사용자에게 제공을 주로한다.  
  
FTP - **파일을 전송**하는데 사용되는 표준 통신 프로토콜
HTTP - **웹 사이트를 이용**하는데 쓰는 프로토콜
SSH - 안전하게 운영을 위한 **암호화 네트워크 프로토콜**
SMTP - **전자 메일 전송**을 위한 인터넷 표준 통신 프로토콜
DNS - **도메인 이름과 IP 주소를 매핑**해주는 서버  
  
      
## 전송 계층

**전송(transport) 계층**은 **송신자**와 **수신자**를 연결하는 통신 서비스 제공과 애플리케이션과 인터넷 계층사이의 데이터를 **중계하는 역할**한다.  
대표적으로 **TCP** 와 **UDP**가 존재한다.  

### TCP

TCP는 패킷사이의 **순서를 보장하고** 연결지향 프로토콜을 사용해 **신뢰성을 구축**해서 수신 여부를 확인하는 **'가상회선 패킷 교환방식'** 을 사용한다.

---

### UDP

UDP는 **순서를 보장하지 않고** 수신 여부를 확인하지 않으며 단순히 데이터만 주는 **'데이터그램 패킷 교환 방식'** 을 사용한다.

#### 가상회선 패킷 교환 방식

모든 패킷을 전송하면 가상회선이 해제되고 패킷들은 전송된 **'순서대로'** 도착하는 방식을 말한다.
<img width="400" alt="1 (1)" src="https://github.com/Hasegos/Study_CS/assets/93961708/b79533c1-aa18-407e-874c-4fd08259019f">

#### 데이터그램 패킷 교환 방식

패킷이 독립적으로 이동하며 최적의 경로를 선택하여 가며, **'순서가 다를 수'** 있는 방식을 말한다.
<img width="400" alt="2 (1)" src="https://github.com/Hasegos/Study_CS/assets/93961708/400ac5a7-c58a-4c35-b259-dc3c0f59f80b">


### TCP 연결 성립 과정

TCP는 신뢰성을 확보할 떄 **'3-웨이 핸드셰이크(3-way handshake)'** 를 사용한다.

![1 (1)](https://github.com/Hasegos/Study_CS/assets/93961708/2ea7a8c1-adc0-4070-9db3-44023b6201a3)

1.SYN 단계 : 클라이언트가 서버에 클라이언트의 **ISN을 담아 SYN을 보낸다.**  
ISN은 새로운 TCP연결 시 첫번째 패킷에 **할당된 임의의 시퀸스 번호**이다
  
2.SYN + ACK 단계 : 서버는 **클라이언트의 SYN을 수신**하고 **서버의 ISN을 보내며** 승인번호로 클라이언트의 ISN + 1을 보낸다.   
  
3.ACK 단계 : 클라이언트는 **서버의 ISN + 1한 값인 승인번호를 담아 ACK를 서버**에 보낸다.  
  
**TCP**는 이러한 과정이 있어 **신뢰성이 있는 계층**이라고 하며 **UDP**는 이런 과정이 없어 **신뢰성이없는 계층**이라 한다.  

SYN - **연결 요청** 플래그  
ACK - **응답** 플래그  
ISN - **초기 네트워크 연결**할 때 할당된 **32비트 고유 시퀸스 번호**  

---

### TCP 연결 해제 과정

TCP가 연결을 해제할 떄는 **4-웨이 핸드셰이크(4-way handshake)** 을 사용한다.

![2 (1)](https://github.com/Hasegos/Study_CS/assets/93961708/b8c205d6-c3e7-481c-95e8-73f4e5415a23)  

* 1번 : **FIN으로 설정된 세그먼트**를 보내고 클라이언트는 **FIN_WAIT_1 상태**로 들어가고 서버를 기다린다.  
* 2번 : 서버는 클라이언트에 **ACK라는 승인 세그먼트**를 보내고 서버는 **CLOSE_WAIT**로 클라이언트는 FIN_WAIT_2 상태로 들어간다.   
* 3번 : 서버는 **ACK를 보내고** 일정시간 후에 클라이언트에 **FIN이라는 세그먼트**를 보낸다. 
* 4번 : 클라이언트는 **TIME_WAIT 상태**가 되고 서버에 **ACK를 다시보내며** 서버는 **CLOSE 상태**가된다.
    이후 어느정도 시간이 지나면 클라이언트와 서버의 **모든 자원 연결을 해제**한다.



